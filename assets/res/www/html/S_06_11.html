<!DOCTYPE html>
<html lang="ko">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width">
<title>한화 Home &amp; Q</title>
<link rel="stylesheet" type="text/css" href="../css/common.css">
<link rel="stylesheet" type="text/css" href="../css/content.css">
<link rel="stylesheet" type="text/css" href="../css/content2.css">
</head>
<body>

<!-- wrap -->
<div class="wrap">

    <!-- header -->
    <div class="header">
        <!-- <h1 class="page_title">실측</h1>
        <a href="#n" class="btn_home">home</a>
        <a href="#n" class="btn_gnb">전체메뉴</a> -->

        <!-- gnb -->
        <!-- <div class="gnb">
            <ul>
                <li class="green"><a href="#n">실측관리</a></li>
                <li class="green"><a href="#n">시공관리</a></li>
                <li class="setting"><a href="#n"><span>설정</span></a></li>
            </ul>
        </div> -->
        <!-- //gnb -->

        <!-- <a href="#n" class="page_prev">이전페이지</a> -->
    </div>

    <!-- //header -->

    <!-- content -->
    <div class="content survey">
        
        <div class="content_area">

            <!-- 본문내용 -->
            
            <div class="accept_wrap">
                <strong class="date">2018-08-31</strong>
                <a href="#n" class="btn middle orange" data-event-page="S_06_13.html">신규예약접수</a>
            </div>
            
            <div class="section">
                
                <!-- srch_wrap -->
                <div class="srch_wrap">
                    <a href="#n" class="btn_srch_open">검색</a>
                    <div class="srch_area">
                        <ul>
                            <li>
                                <strong class="tit">실측(예정)일</strong>
                                <div class="webkit_box">
                                    <span class="box_flex1">
                                        <input type="date" value="" id="searTermFr"><!-- 날짜 -->
                                    </span>
                                    <span class="box_flex0 dash">
                                        ~
                                    </span>
                                    <span class="box_flex1">
                                        <input type="date" value="" id="searTermTo"><!-- 날짜 -->
                                    </span>
                                </div>
                            </li>
                            <li>
                                <strong class="tit">현재진행상태</strong>
                                <div class="webkit_box">
                                    <span class="box_flex1">
                                        <select id="searCnstwStCd">
                                            <option value="0">전체</option>
                                            <option value="1">실측예약</option>
                                            <option value="2">실측확정</option>
                                            <option value="3">실특완료</option>
                                        </select>
                                    </span>
                                </div>
                            </li>
                        </ul>
                        <span class="btn_srch"><a href="#n" class="btn middle gray">검색</a></span>
                        <div class="srch_control">
                            <a href="#n" class="btn_reset">초기화</a>
                            <a href="#n" class="btn_cls"><span>닫기</span></a>
                        </div>
                    </div>
                </div>
                <!-- //srch_wrap -->

                <div class="list_num">
                    <span><em id="cnt">0</em>건 / 총 <em id="totCnt">0</em>건</span>
                </div>
                <!-- TODO : 20181025 li a영역 수정 -->
                <ul class="survey_list">
                    <li>
                        <div class="division type02">
                            <span class="left_txt"><span class="split_w">창호</span><span>현대인테리어</span></span>
                            <span class="rignt_txt">실측접수</span>
                        </div>
                        <div class="mid">
                            <span class="date">2018-08-31 (09:00~10:00)</span>
                            <span class="num">[TI20160523000000] 비거주(개보수)</span>
                            <span class="addr">서울 중구 을지로5길 26 센터원 좋은아파트 11동 1004호</span>
                            <a href="#" class="go_list" data-event-page="S_06_21.html"></a>
                        </div>
                        <div class="bot">
                            <span class="company">서울 창호 시스템</span>
                            <span class="charge">김프로(01012344321)</span>
                        </div>
                    </li>
                    <li>
                        <div class="division type02">
                            <span class="left_txt"><span class="split_w">창호</span><span>현대인테리어</span></span>
                            <span class="rignt_txt">실측접수</span>
                        </div>
                        <div class="mid">
                            <span class="date">2018-08-31 (09:00~10:00)</span>
                            <span class="num">[TI20160523000000] 비거주(개보수)</span>
                            <span class="addr">서울 중구 을지로5길 26 센터원 좋은아파트 11동 1004호</span>
                            <a href="" class="go_list"></a>
                        </div>
                        <div class="bot">
                            <span class="company">서울 창호 시스템</span>
                            <span class="charge">김프로(01012344321)</span>
                        </div>
                    </li>
                    <li>
                        <div class="division type02">
                            <span class="left_txt"><span class="split_w">창호</span><span>현대인테리어</span></span>
                            <span class="rignt_txt">실측접수</span>
                        </div>
                        <div class="mid">
                            <span class="date">2018-08-31 (09:00~10:00)</span>
                            <span class="num">[TI20160523000000] 비거주(개보수)</span>
                            <span class="addr">서울 중구 을지로5길 26 센터원 좋은아파트 11동 1004호</span>
                            <a href="" class="go_list"></a>
                        </div>
                        <div class="bot">
                            <span class="company">서울 창호 시스템</span>
                            <span class="charge">김프로(01012344321)</span>
                        </div>
                    </li>
                </ul>
                <!--// TODO : 20181025 a영역 수정 -->
                <div class="tac mt20">
                    <a href="#n" class="btn large basic" id="addList"><span class="add">더보기</span></a>
                </div>
            </div>
            <hr>
            <!-- 본문내용 -->
        </div>
    </div>
    <!-- //content -->

</div>
<!-- //wrap -->
<script type="text/javascript" src="../js/mcore.min.js"></script>
<script type="text/javascript" src="../js/header.js"></script>
<script type="text/javascript" src="../js/moment.min.js"></script>
<script type=“text/javascript” src="../js/locales.min.js"></script>
<script type="text/javascript" src="../js/module.js"></script>
<!-- // -->
<script type="text/javascript">
    "use strict";

    //TODO: 개발 미비
    
    //페이지 이동시 전달할 데이터
    var pageData = {};

    //실측 검색 처리 함수
    /**
    * @author dh.lee@ttb.co.kr
    * @version 0.1
    * @since 2018.11.22
    * @description 실측 검색 을 모듈화 하기 위한 함수
    * 태그에 설정해 줘야 하는 id 목록 
    * 1. searCnstwStCd : 셀렉트 박스 id
    * 2. searTermFr : 시작시간 input 태그 id 
    * 3. searTermTo : 종료시간 input 태그 id 
    * 
    * 초기화 버튼은 css 를 그대로 사용해서 셀렉트 하므로 설정하지 않아도 된다. 
    * 이 함수를 사용하는 페이지는 S_06_11, A_05_01 이다. 
    * 
    */
    function inquireSvrList(searchCallback){
        //셀렉트 변수 
        var $startTime = $("#searTermFr");
        var $endTime = $("#searTermTo");
        var $selectBox = $("#searCnstwStCd");
        var $btnSearch = $(".btn_srch > a.btn");
        var $btnReset = $(".srch_control .btn_reset");
        
        //초기화 함수 
        function init(){
            //셀렉트 박스 데이터 먼저 불러온다. 
            selectData(function(recevedData) {
                console.log("svy/lst/inquireSvrStdList",recevedData);
                $("#searCnstwStCd").children().remove();
                $.each(recevedData.retList,function(v){
                    console.log("list:",v);
                    $("#searCnstwStCd").append("<option value='"+v.commonLineCode+"'>"+v.commonLineName+"</option>");
                });
            });
            // 이벤트 등록
            event();
        }
        //이벤트 등록 함수 
        function event(){
            // 검색 초기화 버튼 이벤트
            $btnReset.off("click").on("click", function() {
                $startTime.val("");
                $endTime.val("");
                $selectBox.val("");
            });

            //검색 API
            $btnSearch.off("click").on("click",function(){
                searchData(searchCallback);
            });
        }

        // 실측 리스트 검색조건 조회 API 연동
        function selectData(successCallback){
            httpSend({
                path: 'svy/lst/inquireSvrStdList',
                successCallback: successCallback
            });
        }

        // 검색 API 연동
        function searchData(successCallback){
            httpSend({
                path: 'svy/lst/inquireSvrList',
                data:{
                    searTermFr : ($startTime.val() == "")? "" : moment($startTime.val()).format("YYYYMMDD"),
                    searTermTo : ($endTime.val() == "")? "" : moment($endTime.val()).format("YYYYMMDD"),
                    searCnstwStCd : $selectBox.val(),
                },
                successCallback: successCallback
            });
        }
        //초기화
        init();
    };

    $(document).ready(function(){
        $(".header").header({
            type:"construction",
            title:"실측",
            headerType:"menu",
            callback:function(){
                pageNav(pageData).init();
            }
        });



        // 상단 날짜 표시
        $(".accept_wrap .date").text(moment().format("YYYY-MM-DD"));

        //더보기 버튼 클릭시 이벤트 등록
        $("#addList").off("click").on("click",function(){
            $("#search").trigger("click");
        });

        // 서치 후 리턴되는 데이터 를 가지고 화면 리스트를 만드는 함수
        inquireSvrList(function(recevedData) {
            console.log("svy/lst/inquireSvrList :: search",recevedData);

            //리스트 생성
            listMake(recevedData.retList);

            //페이지 이동 다시 이벤트 등록 
            pageNav().init();

            //더보기 버튼 현재 페이지와 최종 페이지가 같으면 더보기 버튼 사라짐 
            (recevedData.cnt == recevedData.totCnt)? $("#addList").hide() : $("#addList").show(); 
            $("#cnt").text(recevedData.cnt);
            $("#totCnt").text(recevedData.totCnt);
        });

        //랜더링
        //검색 결과 리스트로 생성하는 함수
        function listMake(param){
            // param = [{
            //     "cnstwHpwCd": null,
            //     "cnstwStName": "완료",
            //     "jobsTypeCd1": "20",
            //     "jobsTypeCd2": "10",
            //     "muCode": "2",
            //     "muName": "창호",
            //     "cnstwHpwNm": null,
            //     "vndorName": "법원지물",
            //     "vndorCode": 10601,
            //     "cnstwOrdNo": "S01-20181018-R005",
            //     "cnstwFirmCd": 24595,
            //     "RNUM": 1,
            //     "cnstwFirmNm": "(사)한국경제연구원",
            //     "jobsTypeName1": "개보수",
            //     "cnstwRsrtTim": "03",
            //     "jobsTypeName2": "거주",
            //     "cnstwRsrtTimName": "10:00",
            //     "cnstwOlv": null,
            //     "addrDetail": "경기빌딩",
            //     "addr": "서울특별시 중구 남대문로10길 9",
            //     "cnstwRsrtDt": "20181120",
            //     "ccpc": null
            // }];

            //태그 생성 
            //TODO : 미구현 목록 
            /*
            */
            function makeTag(data){
                return $('<li>\
                        <div class="division type02">\
                            <span class="left_txt"><span class="split_w">'+data.muName+'</span><span>'+data.vndorName+'</span></span>\
                            <span class="rignt_txt">'+data.cnstwStName+'</span>\
                        </div>\
                        <div class="mid">\
                            <span class="date">'+moment(data.cnstwRsrtDt).format("YYYY-MM-DD")+'('+data.cnstwRsrtTim+')</span>\
                            <span class="num">['+data.cnstwOrdNo+'] '+data.jobsTypeName2+'('+data.jobsTypeName1+')</span>\
                            <span class="addr">'+data.addr+''+data.addrDetail+'</span>\
                            <a href="#" class="go_list" data-event-page="S_06_21.html"></a>\
                        </div>\
                        <div class="bot">\
                            <span class="company">'+data.cnstwFirmNm+'</span>\
                            <span class="charge">'+((data.cnstwHpwNm)?data.cnstwHpwNm:"없음")+((data.ccpc)?"("+data.ccpc+")":"(없음)")+'</span>\
                        </div>\
                    </li>');
            };
            
            //태그 랜더링 
            $(".survey_list").children().remove();
            $(param).each(function(index,el){
                console.log(el);
                $(".survey_list").append(makeTag(el));
            });
        }
    });
    
    M.onReady(function(e) {
        //ready event handle code here
        console.log("onReady");
    }).onHide(function(e){
        //hide event handle code here
        console.log("onHide");
    }).onRestore(function(e) {
        //restore event handle code here
        console.log("onRestore");
    }).onResume(function(e) {
        //resume event handle code here
        console.log("onResume");
    }).onDestroy(function(e) {
        //destroy event handle code here
        console.log("onDestroy");
    }).onBack(function() {
        //back event handle code here
        console.log("onBack");
        M.page.back();
    }).onKey(function(e) {
        //key event handle code here(android only)
        console.log("onKey");
    });
</script>
<script type="text/javascript" src="../js/common.js"></script>
</body>
</html>
